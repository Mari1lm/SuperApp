<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Contigo Mam√° 360¬∞ ‚Äî Mockup Claro</title>
<style>
  :root{
    --bg:#fff7fb; --card:#fff; --line:#f6d6e1; --text:#374151; --muted:#6b7280;
    --brand:#f472b6; --brand-2:#fb7185; --brand-3:#f59e0b; --accent:#9d174d;
    --chip:#fff0f6; --shadow:0 10px 30px rgba(31,41,55,.08); --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:
      radial-gradient(1000px 600px at 100% -10%, rgba(244,114,182,.15), transparent 60%),
      radial-gradient(900px 600px at -10% 0%, rgba(251,113,133,.12), transparent 60%),
      linear-gradient(180deg, var(--bg), #fff);
  }
  a{color:#ec4899}
  .app{max-width:480px; margin:0 auto; min-height:100dvh; padding:16px 16px 88px; display:flex; flex-direction:column; gap:14px; position:relative}
  header{display:flex; align-items:center; gap:12px; padding:8px 4px 0}
  .logo{width:44px; height:44px; border-radius:14px; background:radial-gradient(circle at 30% 20%, #ffe4e6, #f472b6 55%, #9d174d); box-shadow:var(--shadow)}
  .hgroup{display:flex; flex-direction:column}
  .title{font-weight:900; letter-spacing:.2px}
  .subtitle{font-size:12px; color:var(--muted)}

  .screen{display:none; animation:fade .25s ease}
  .screen.active{display:block}
  @keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

  .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}
  .stack{display:flex; flex-direction:column; gap:12px}
  .row{display:flex; gap:10px; align-items:center}
  .grid{display:grid; gap:12px}
  .grid.cols2{grid-template-columns:1fr 1fr}
  .grid.cols3{grid-template-columns:1fr 1fr 1fr}
  .pill{background:var(--chip); border:1px solid var(--line); padding:8px 12px; border-radius:999px; font-size:13px}
  .badge{font-size:11px; padding:4px 8px; border-radius:999px; background:#fff; border:1px solid var(--line); color:var(--accent)}
  .muted{color:var(--muted)}
  .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 14px; border-radius:14px; border:1px solid var(--line); background:#fff; color:var(--text); cursor:pointer; font-weight:700}
  .btn.brand{background:linear-gradient(180deg, var(--brand), var(--brand-2)); color:#fff; border:none}
  .btn.ghost{background:transparent}
  .field{display:flex; flex-direction:column; gap:6px}
  label{font-size:13px; color:#475569}
  input, select, textarea{width:100%; padding:12px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; color:var(--text); outline:none}
  .chips{display:flex; flex-wrap:wrap; gap:8px}
  .chip{padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:#fff; font-size:12px; cursor:pointer}
  .chip.active{outline:2px solid var(--brand); color:#9d174d; background:#fff0f6}
  .stat{border:1px solid var(--line); border-radius:14px; background:#fff; padding:12px}
  .bar{height:8px; background:#f3f4f6; border:1px solid var(--line); border-radius:999px; overflow:hidden}
  .bar i{display:block; height:100%; background:linear-gradient(90deg,var(--brand),var(--brand-2),var(--brand-3))}
  .empty{color:#9ca3af; font-size:14px}
  .avatar{width:64px;height:64px;border-radius:16px;border:1px solid var(--line);background:radial-gradient(circle at 30% 20%, #fed7e2, #f472b6 60%, #9d174d)}
  .nimg{width:64px;height:64px;border-radius:16px;border:1px solid var(--line);object-fit:cover;display:block}

  /* Tabbar */
  .tabbar{position:fixed; left:0; right:0; bottom:0; z-index:10; margin:auto; max-width:480px; padding:10px 12px; display:none; grid-template-columns:repeat(5,1fr); gap:8px; background:#ffffffcc; backdrop-filter:blur(8px); border-top:1px solid var(--line)}
  .tabbar button{display:flex; flex-direction:column; align-items:center; gap:4px; padding:8px 6px; border-radius:12px; border:1px solid transparent; background:transparent; color:#475569; cursor:pointer; font-size:12px}
  .tabbar button .ico{font-size:18px}
  .tabbar button.active{color:#9d174d; border-color:#fce7f3; background:#fff0f6}

  /* Chat */
  .chat{display:flex; flex-direction:column; gap:10px; height:360px; overflow:auto; padding:10px; background:#fff; border:1px solid var(--line); border-radius:16px}
  .bubble{max-width:78%; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background:#fff}
  .me{align-self:flex-end; background:#fff0f6}
  .bot{align-self:flex-start; background:#f8fafc}
  .composer{display:flex; gap:8px; margin-top:8px}
  .composer input{flex:1}

  /* Calendario inline */
  .cal-wrap{border:1px solid var(--line); border-radius:16px; padding:12px}
  .cal-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
  .cal-grid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
  .day{background:#fff; border:1px solid var(--line); border-radius:10px; padding:8px; min-height:62px; position:relative}
  .dot{width:6px; height:6px; border-radius:50%; background:#ec4899; position:absolute; right:6px; bottom:6px}

  /* Toggle de pesta√±as del acceso */
  .tabbtn{transition:.15s ease}
  .tabbtn.active{background:linear-gradient(180deg, var(--brand), var(--brand-2)); color:#fff; border:none}
  .tabbtn:not(.active){background:#fff; color:var(--text); border:1px solid var(--line)}

  /* MODAL */
  .modal-backdrop{position:fixed; inset:0; background:#0006; display:none; align-items:center; justify-content:center; z-index:50}
  .modal{width:min(480px,92%); background:#fff; border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow); padding:16px}
  .modal-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div class="hgroup">
        <div class="title">Contigo Mam√° 360¬∞</div>
        <div class="subtitle">MVP Mockup ‚Ä¢ Yo mam√° + Nawi Wawa + Tribu</div>
      </div>
    </header>

    <!-- Tabbar -->
    <div class="tabbar" id="tabbar">
      <button data-view="perfil"><span class="ico">üë§</span><span>Perfil</span></button>
      <button data-view="yo" class="active"><span class="ico">üë©‚Äçüëß‚Äçüë¶</span><span>Yo mam√°</span></button>
      <button data-view="tribu"><span class="ico">üë®‚Äçüë©‚Äçüëß</span><span>Tribu</span></button>
      <button data-view="nawi"><span class="ico">üë©‚Äçüçº</span><span>Nawi Wawa</span></button>
      <button data-view="faq"><span class="ico">üí¨</span><span>Chat</span></button>
    </div>

    <!-- ACCESO -->
    <section class="screen active" id="acceso">
      <div class="card stack">
        <div class="grid cols2">
          <button class="btn tabbtn active" data-tab="loginTab">Ya tengo cuenta</button>
          <button class="btn tabbtn" data-tab="signupTab">Crear mi cuenta</button>
        </div>

        <!-- Login -->
        <div id="loginTab" class="stack">
          <div class="field"><label>Email o tel√©fono</label><input id="loginUser" placeholder="tu@correo.com / 999 888 777"/></div>
          <div class="field"><label>Contrase√±a (demo)</label><input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
          <button class="btn brand" id="btnLogin">Ingresar</button>
        </div>

        <!-- Registro -->
        <div id="signupTab" class="stack" style="display:none">
          <div class="field"><label>Nombre</label><input id="r_nombre" placeholder="Tu nombre"/></div>
          <div class="field"><label>Email o tel√©fono</label><input id="r_contacto" placeholder="tu@correo.com / 999 888 777"/></div>
          <div class="field"><label>Contrase√±a (demo)</label><input id="r_pass" type="password" placeholder="M√≠nimo 6 caracteres"/></div>

          <div class="grid cols2">
            <div class="field"><label>Edad del beb√© (meses)</label><input id="r_edad" type="number" min="0" max="24" value="2"/></div>
            <div class="field">
              <label>¬øPrimer hijo/a?</label>
              <div class="chips"><span class="chip" data-group="primer">S√≠</span><span class="chip" data-group="primer">No</span></div>
            </div>
          </div>

          <div class="field">
            <label>Nivel de apoyo disponible</label>
            <div class="chips"><span class="chip" data-group="apoyoNivel">Bajo</span><span class="chip" data-group="apoyoNivel">Medio</span><span class="chip" data-group="apoyoNivel">Alto</span></div>
          </div>
          <div class="field">
            <label>¬øQui√©nes te apoyan?</label>
            <div class="chips" id="chipsApoyos">
              <span class="chip" data-group="apoyos">Pareja</span>
              <span class="chip" data-group="apoyos">Hermanos</span>
              <span class="chip" data-group="apoyos">Padres</span>
              <span class="chip" data-group="apoyos">Amigas</span>
              <span class="chip" data-group="apoyos">Familia</span>
              <span class="chip" data-group="apoyos">Vecinos</span>
              <span class="chip" data-group="apoyos">Otro</span>
            </div>
            <input id="apoyoOtro" placeholder="Si elegiste 'Otro', ¬øqui√©n?" style="display:none"/>
          </div>

          <div class="field"><label>Hijos/as (nombres, separados por coma)</label><input id="r_hijos" placeholder="Ej: Lucas, Renata"/></div>
          <div class="row"><input id="r_whatsapp" type="checkbox" style="width:auto"/><label for="r_whatsapp">Quiero recibir apoyo por WhatsApp</label></div>
          <button class="btn brand" id="btnRegistrar">Crear cuenta y entrar</button>
        </div>
      </div>
    </section>

    <!-- YO MAM√Å -->
    <section class="screen" id="yo">
      <div class="card stack">
        <div class="row" style="justify-content:space-between">
          <h3 style="margin:0">Yo mam√°</h3>
          <span class="badge" id="segmento">‚Äî</span>
        </div>
        <div class="grid cols2">
          <select id="logTipo">
            <option value="">Selecciona‚Ä¶</option>
            <option>Salud</option><option>Cansancio</option><option>Sue√±o</option>
            <option>√Ånimo</option><option>Rutina de beb√©</option><option>Lactancia</option>
          </select>
          <input id="logAnimo" type="number" min="1" max="5" placeholder="1‚Äì5"/>
        </div>
        <div class="grid cols2">
          <input id="logFecha" type="date"/>
          <button class="btn brand" id="btnGuardarLog">Guardar</button>
        </div>
      </div>

      <div class="cal-wrap">
        <div class="cal-head">
          <button class="btn" id="calPrev">‚Üê</button>
          <div class="pill" id="calTitulo">‚Äî</div>
          <button class="btn" id="calNext">‚Üí</button>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div class="stack" id="calDetalle"></div>
      </div>

      <div class="card stack">
        <h4 style="margin:0">Te aconsejamos</h4>
        <div class="stack">
          <div class="pill">üíó "Lo haces incre√≠ble. Pide ayuda; criar tambi√©n es hacer equipo."</div>
          <div class="pill">üïØÔ∏è 3 respiraciones profundas antes de dormir pueden mejorar tu descanso.</div>
          <div class="pill">üéß Charla: "Sue√±o del RN en 20 min" ‚Äî Jue 7pm, virtual.
            <button class="btn" id="btnInscribirme1">Inscribirme</button>
          </div>
        </div>
      </div>

      <div class="grid cols3">
        <div class="stat"><div class="muted" style="font-size:12px">Registros hoy</div><div id="statHoy" style="font-weight:800;font-size:20px">0</div><div class="bar"><i id="barHoy" style="width:0%"></i></div></div>
        <div class="stat"><div class="muted" style="font-size:12px">Semana</div><div id="statSemana" style="font-weight:800;font-size:20px">0</div><div class="bar"><i id="barSem" style="width:0%"></i></div></div>
        <div class="stat"><div class="muted" style="font-size:12px">√Ånimo prom.</div><div id="statAnimo" style="font-weight:800;font-size:20px">‚Äî</div><div class="bar"><i id="barAni" style="width:0%"></i></div></div>
      </div>
    </section>

    <!-- CHAT -->
    <section class="screen" id="faq">
      <div class="card stack">
        <h3 style="margin:0 0 6px">Chat con el bot ü§ñ</h3>
        <div class="chips">
          <span class="chip" id="chipAyuda">¬øC√≥mo uso la app?</span>
          <span class="chip" id="chipPerfil">¬øD√≥nde edito mi perfil?</span>
          <span class="chip" id="chipYo">¬øC√≥mo registro mi d√≠a?</span>
          <span class="chip" id="chipTribu">¬øC√≥mo me inscribo a charlas?</span>
          <span class="chip" id="chipNawi">¬øC√≥mo busco una ni√±era?</span>
          <span class="chip" id="chipLactancia">Lactancia</span>
          <span class="chip" id="chipSueno">Sue√±o</span>
          <span class="chip" id="chipRutina">Rutinas</span>
        </div>
        <div class="chat" id="chat"><div class="bubble bot">Hola, soy tu asistente. Puedo guiarte por la app o darte tips de lactancia, sue√±o y rutinas.</div></div>
        <div class="composer">
          <input id="inp" placeholder="Escribe tu pregunta..."/>
          <button class="btn brand" id="btnSend">Enviar</button>
        </div>
      </div>
    </section>

    <!-- NAWI WAWA -->
    <section class="screen" id="nawi">
      <div class="card stack">
        <h3 style="margin:0">Nawi Wawa ‚Äî Buscar ni√±eras üë©‚Äçüçº‚ú®</h3>
        <div class="muted" style="font-size:13px">Explora perfiles verificados y conecta por WhatsApp.</div>
        <div class="row" style="flex-wrap:wrap">
          <select id="f_zona">
            <option value="">Distrito</option>
            <option>Lima Centro</option><option>Lima Norte</option><option>Lima Sur</option><option>Lima Este</option>
            <option>Miraflores</option><option>San Isidro</option><option>Santiago de Surco</option><option>La Molina</option>
          </select>
          <select id="f_modal">
            <option value="">Modalidad vivienda</option>
            <option>Cama adentro</option><option>Cama afuera</option>
          </select>
          <button class="btn brand" id="btnBuscarNawi">Buscar</button>
        </div>
        <div class="stack" id="nannies"></div>
      </div>
    </section>

    <!-- PERFIL (mam√° usuaria) -->
    <section class="screen" id="perfil">
      <div class="card stack">
        <div class="row" style="gap:12px">
          <div class="avatar" aria-hidden="true"></div>
          <div style="flex:1">
            <h3 id="p_nombre" style="margin:0">Mam√°</h3>
            <div class="muted" id="p_contacto" style="font-size:12px">‚Äî</div>
          </div>
          <button class="btn" id="btnEditarNombre" title="Editar nombre">‚úèÔ∏è</button>
        </div>
        <div class="grid cols2">
          <div class="pill">üë∂ Edad beb√©: <b id="p_edad">‚Äî</b></div>
          <div class="pill">üçº Primer hijo/a: <b id="p_primer">‚Äî</b></div>
          <div class="pill">ü§ù Nivel de apoyo: <b id="p_apoyo">‚Äî</b></div>
          <div class="pill">üë®‚Äçüë©‚Äçüëß Qui√©nes te apoyan: <b id="p_apoyos">‚Äî</b></div>
        </div>
      </div>

      <div class="card stack">
        <div class="row" style="justify-content:space-between">
          <h4 style="margin:0">Hijos/as</h4>
          <button class="btn" id="btnEditarHijos">‚úèÔ∏è</button>
        </div>
        <div id="listaHijos" class="chips"></div>
        <div class="empty" id="emptyHijos">A√∫n no registraste hijos. Puedes agregar desde ‚úèÔ∏è.</div>
        <button class="btn" id="btnLogout">Cerrar sesi√≥n</button>
      </div>
    </section>

    <!-- TRIBU (Agenda + reuniones) -->
    <section class="screen" id="tribu">
      <div class="card stack">
        <div class="row" style="justify-content:space-between">
          <h3 style="margin:0">Tribu ‚Äî Agenda de charlas y talleres üìÖ</h3>
          <button class="btn brand" id="btnNuevaReunion">Programar reuni√≥n</button>
        </div>
        <div id="agenda" class="stack"></div>
      </div>
    </section>

    <!-- MODAL REUNI√ìN -->
    <div class="modal-backdrop" id="bk">
      <div class="modal">
        <div class="modal-head">
          <h3 style="margin:0">Programar reuni√≥n</h3>
          <button class="btn" id="btnCerrarModal">‚úñ</button>
        </div>
        <div class="stack">
          <div class="field"><label>Tema o t√≠tulo</label><input id="m_tema" placeholder="Charla entre mam√°s"/></div>
          <div class="grid cols2">
            <div class="field"><label>Fecha</label><input id="m_fecha" type="date"/></div>
            <div class="field"><label>Hora</label><input id="m_hora" type="time" value="19:00"/></div>
          </div>
          <div class="field"><label>Link (Zoom/Meet)</label><input id="m_link" placeholder="https://‚Ä¶"/></div>
          <button class="btn brand" id="btnCrearReunion">Crear reuni√≥n</button>
        </div>
      </div>
    </div>

    <!-- TOAST -->
    <div id="toast" style="
      position:fixed;left:50%;top:16px;transform:translateX(-50%) translateY(-20px);
      background:#fff;color:#9d174d;border:1px solid var(--line);border-radius:12px;
      box-shadow:0 10px 30px rgba(31,41,55,.08);padding:12px 14px;z-index:9999;opacity:0;pointer-events:none;
      display:flex;gap:8px;align-items:center;font-weight:700;">
      <span>üå∑ ¬°Lo est√°s haciendo bien, mam√°! Registro guardado.</span>
    </div>
  </div>

<script>
/* ===== Helpers UI ===== */
var tabbar = document.getElementById('tabbar');
var screens = Array.prototype.slice.call(document.querySelectorAll('.screen'));
function goto(view){
  screens.forEach(function(s){ s.classList.toggle('active', s.id===view); });
  if(view!=='acceso'){ tabbar.style.display='grid'; }
  Array.prototype.forEach.call(tabbar.children, function(b){ b.classList.toggle('active', b.dataset.view===view); });
  window.scrollTo(0,0);
}
tabbar.addEventListener('click', function(e){
  var btn = e.target.closest('button');
  if(!btn) return;
  goto(btn.dataset.view);
});

/* ===== Access tabs ===== */
function showTab(id){
  var login = document.getElementById('loginTab');
  var signup = document.getElementById('signupTab');
  if(login) login.style.display = (id==='loginTab')?'block':'none';
  if(signup) signup.style.display = (id==='signupTab')?'block':'none';
}
var tabButtons = Array.prototype.slice.call(document.querySelectorAll('.tabbtn'));
function setAccessTab(tabId){
  showTab(tabId);
  tabButtons.forEach(function(b){ b.classList.toggle('active', b.dataset.tab===tabId); });
}
tabButtons.forEach(function(b){ b.addEventListener('click', function(){ setAccessTab(b.dataset.tab); }); });
setAccessTab('loginTab');

/* ===== Chips ===== */
function toggleChip(el){
  var group = el.getAttribute('data-group');
  if(group==='apoyos'){
    el.classList.toggle('active');
    var anyOtro = Array.prototype.some.call(document.querySelectorAll('.chip[data-group="apoyos"].active'), function(x){ return x.textContent==='Otro'; });
    document.getElementById('apoyoOtro').style.display = anyOtro ? 'block':'none';
    return;
  }
  Array.prototype.forEach.call(document.querySelectorAll('.chip[data-group="'+group+'"]'), function(c){ c.classList.remove('active'); });
  el.classList.add('active');
}
Array.prototype.forEach.call(document.querySelectorAll('.chip[data-group]'), function(c){
  c.addEventListener('click', function(){ toggleChip(c); });
});

/* ===== Estado ===== */
var state = {
  usuario:null,
  perfil:null,
  registros: JSON.parse(localStorage.getItem('cm360.logs')||'[]')
};

/* ===== Toast ===== */
function showToast(msg){
  var t = document.getElementById('toast');
  t.firstElementChild.textContent = msg || 'üå∑ ¬°Lo est√°s haciendo bien, mam√°! Registro guardado.';
  t.style.opacity='1';
  t.style.transform='translateX(-50%) translateY(0)';
  setTimeout(function(){
    t.style.opacity='0';
    t.style.transform='translateX(-50%) translateY(-20px)';
  }, 1600);
}

/* ===== Login / Registro ===== */
document.getElementById('btnLogin').addEventListener('click', function(){
  var u = document.getElementById('loginUser').value.trim();
  var p = document.getElementById('loginPass').value.trim();
  if(!u || !p){ showToast('Completa usuario y contrase√±a.'); return; }
  state.usuario = {nombre:'Mam√°', contacto:u};
  if(!state.perfil){ state.perfil = {edad:2, primer:'S√≠', apoyoNivel:'Medio', apoyos:['Pareja'], whatsapp:true, hijos:[]}; }
  refrescarPerfil(); initCalendarioToToday(); goto('yo'); renderTodo();
});

document.getElementById('btnRegistrar').addEventListener('click', function(){
  var nombre = document.getElementById('r_nombre').value.trim();
  var contacto = document.getElementById('r_contacto').value.trim();
  var pass = document.getElementById('r_pass').value.trim();
  var edad = parseInt(document.getElementById('r_edad').value||'0',10);
  var primer = (document.querySelector('.chip[data-group="primer"].active')||{}).textContent || 'S√≠';
  var apoyoNivel = (document.querySelector('.chip[data-group="apoyoNivel"].active')||{}).textContent || 'Medio';
  var apoyosSel = Array.prototype.map.call(document.querySelectorAll('.chip[data-group="apoyos"].active'), function(x){ return x.textContent; });
  var otro = document.getElementById('apoyoOtro').value.trim();
  if(apoyosSel.indexOf('Otro')>-1 && otro){ apoyosSel[apoyosSel.indexOf('Otro')] = otro; }
  var hijos = (document.getElementById('r_hijos').value||'').split(',').map(function(s){return s.trim();}).filter(function(x){return !!x;});
  var whatsapp = document.getElementById('r_whatsapp').checked;
  if(!nombre || !contacto || pass.length<6){ showToast('Revisa nombre, contacto y contrase√±a (‚â•6).'); return; }
  state.usuario = {nombre:nombre, contacto:contacto};
  state.perfil = {edad:edad, primer:primer, apoyoNivel:apoyoNivel, apoyos:apoyosSel, whatsapp:whatsapp, hijos:hijos};
  refrescarPerfil(); initCalendarioToToday(); goto('yo'); renderTodo();
});

document.getElementById('btnLogout').addEventListener('click', function(){
  localStorage.removeItem('cm360.logs');
  state.usuario=null; state.perfil=null; state.registros=[];
  tabbar.style.display='none'; goto('acceso');
});

/* ===== Perfil ===== */
function refrescarPerfil(){
  document.getElementById('p_nombre').textContent = (state.usuario && state.usuario.nombre) ? state.usuario.nombre : 'Mam√°';
  document.getElementById('p_contacto').textContent = (state.usuario && state.usuario.contacto) ? state.usuario.contacto : '‚Äî';
  document.getElementById('p_edad').textContent = ((state.perfil && state.perfil.edad)!=null ? state.perfil.edad : '‚Äî') + ' m';
  document.getElementById('p_primer').textContent = state.perfil ? state.perfil.primer : '‚Äî';
  document.getElementById('p_apoyo').textContent = state.perfil ? state.perfil.apoyoNivel : '‚Äî';
  document.getElementById('p_apoyos').textContent = (state.perfil && state.perfil.apoyos && state.perfil.apoyos.length) ? state.perfil.apoyos.join(', ') : '‚Äî';

  var hijosWrap = document.getElementById('listaHijos');
  hijosWrap.innerHTML='';
  var hijos = (state.perfil && state.perfil.hijos) ? state.perfil.hijos : [];
  hijos.forEach(function(h){
    var s=document.createElement('span'); s.className='pill'; s.textContent='üë∂ '+h; hijosWrap.appendChild(s);
  });
  document.getElementById('emptyHijos').style.display = hijos.length ? 'none':'block';

  var edad = state.perfil ? (state.perfil.edad||0) : 0;
  var etapa = edad<=3 ? '0‚Äì3m' : (edad<=6 ? '3‚Äì6m' : '6m+');
  var primerx = (state.perfil && /No/i.test(state.perfil.primer||'')) ? 'no primerx' : 'primerx';
  var apoyo = (state.perfil ? (state.perfil.apoyoNivel||'Medio') : 'Medio').toLowerCase();
  document.getElementById('segmento').textContent = etapa + ' | ' + primerx + ' | apoyo ' + apoyo;
}
document.getElementById('btnEditarNombre').addEventListener('click', function(){
  var nuevo = prompt('Nuevo nombre:', state.usuario ? state.usuario.nombre : '');
  if(nuevo){ state.usuario.nombre = nuevo; refrescarPerfil(); }
});
document.getElementById('btnEditarHijos').addEventListener('click', function(){
  var actual = (state.perfil && state.perfil.hijos) ? state.perfil.hijos.join(', ') : '';
  var txt = prompt('Hijos/as (separados por coma):', actual);
  if(txt!==null){ state.perfil.hijos = txt.split(',').map(function(s){return s.trim();}).filter(function(x){return !!x;}); refrescarPerfil(); }
});

/* ===== Yo mam√°: registros ===== */
var logFecha = document.getElementById('logFecha');
function todayStr(d){ d = d || new Date(); var y=d.getFullYear(); var m=('0'+(d.getMonth()+1)).slice(-2); var dd=('0'+d.getDate()).slice(-2); return y+'-'+m+'-'+dd; }

document.getElementById('btnGuardarLog').addEventListener('click', function(){
  var tipo  = document.getElementById('logTipo').value;
  var animo = parseInt(document.getElementById('logAnimo').value||'0',10) || null;
  var date  = logFecha.value || todayStr();

  if(!tipo){ showToast('Selecciona un tipo.'); return; }
  if(!animo){ showToast('Ingresa un valor de 1 a 5.'); return; }

  state.registros.push({date:date, tipo:tipo, animo:animo});
  localStorage.setItem('cm360.logs', JSON.stringify(state.registros));

  document.getElementById('logTipo').selectedIndex = 0;
  document.getElementById('logAnimo').value = '';

  dibujarCalendario(); mostrarDia(new Date(date)); renderStats();
  showToast('üå∑ ¬°Lo est√°s haciendo bien, mam√°! Registro guardado.');
});

/* ===== Stats ===== */
function regsByDateStr(ymd){ return state.registros.filter(function(r){ return r.date===ymd; }); }
function weekStats(){
  var d=new Date(); var day=(d.getDay()+6)%7;
  var start=new Date(d.getFullYear(),d.getMonth(),d.getDate()-day);
  var end=new Date(start); end.setDate(start.getDate()+7);
  var list = state.registros.filter(function(r){ var t=new Date(r.date); return t>=start && t<end; });
  var hoy = state.registros.filter(function(r){ return r.date===todayStr(); });
  var animos = list.map(function(r){ return r.animo; }).filter(function(x){ return !!x; });
  return {hoy:hoy.length, semana:list.length, prom: animos.length ? (animos.reduce(function(a,b){return a+b;},0)/animos.length) : null};
}
function renderStats(){
  var s = weekStats();
  document.getElementById('statHoy').textContent = s.hoy;
  document.getElementById('statSemana').textContent = s.semana;
  document.getElementById('statAnimo').textContent = (s.prom==null ? '‚Äî' : s.prom.toFixed(1));
  document.getElementById('barHoy').style.width = Math.min(s.hoy*20,100)+'%';
  document.getElementById('barSem').style.width = Math.min(s.semana*12,100)+'%';
  document.getElementById('barAni').style.width = (s.prom ? s.prom*20 : 0)+'%';
}

/* ===== Calendario ===== */
var calMes, calAno;
function initCalendarioToToday(){
  var t=new Date(); calMes=t.getMonth(); calAno=t.getFullYear();
  logFecha.value=todayStr(t); dibujarCalendario(); mostrarDia(t);
}
function cambiarMes(delta){
  calMes += delta; if(calMes<0){calMes=11; calAno--;} if(calMes>11){calMes=0; calAno++;}
  dibujarCalendario(); document.getElementById('calDetalle').innerHTML='';
}
document.getElementById('calPrev').addEventListener('click', function(){ cambiarMes(-1); });
document.getElementById('calNext').addEventListener('click', function(){ cambiarMes(1); });

function dibujarCalendario(){
  var grid=document.getElementById('calGrid');
  var titulo=document.getElementById('calTitulo');
  var first=new Date(calAno,calMes,1); var startDay=(first.getDay()+6)%7; var days=new Date(calAno,calMes+1,0).getDate();
  titulo.textContent=new Date(calAno,calMes).toLocaleDateString('es-PE',{month:'long',year:'numeric'});
  grid.innerHTML='';

  ['L','M','M','J','V','S','D'].forEach(function(d){
    var h=document.createElement('div'); h.className='muted'; h.style.textAlign='center'; h.textContent=d; grid.appendChild(h);
  });
  for(var i=0;i<startDay;i++){ var emp=document.createElement('div'); emp.className='day'; emp.style.visibility='hidden'; grid.appendChild(emp); }
  for(var d=1; d<=days; d++){
    var cell=document.createElement('div'); cell.className='day'; var fecha=new Date(calAno,calMes,d);
    var ymd=todayStr(fecha);
    var n=document.createElement('div'); n.style.fontWeight='700'; n.textContent=String(d); cell.appendChild(n);
    if(regsByDateStr(ymd).length){ var dot=document.createElement('div'); dot.className='dot'; cell.appendChild(dot); }
    (function(ymdCopy, fechaCopy){
      cell.addEventListener('click', function(){ logFecha.value=ymdCopy; mostrarDia(fechaCopy); });
    })(ymd, fecha);
    grid.appendChild(cell);
  }
}
function mostrarDia(fecha){
  var ymd=todayStr(fecha);
  var det=document.getElementById('calDetalle');
  det.innerHTML='';
  var h=document.createElement('h4'); h.style.margin='6px 0'; h.textContent='Registros de '+fecha.toLocaleDateString(); det.appendChild(h);
  var list=regsByDateStr(ymd);
  if(!list.length){ var e=document.createElement('div'); e.className='empty'; e.textContent='Sin registros este d√≠a.'; det.appendChild(e); return; }
  list.forEach(function(r){
    var el=document.createElement('div'); el.className='pill';
    var txt = r.tipo + (r.animo ? ' ('+r.animo+'/5)' : '');
    el.textContent = txt; det.appendChild(el);
  });
}

/* ===== Chat ===== */
var chat = document.getElementById('chat');
function addBubble(role, text){
  var b=document.createElement('div');
  b.className='bubble '+(role==='me'?'me':'bot'); b.textContent=text;
  chat.appendChild(b); chat.scrollTop=chat.scrollHeight;
}
function respond(q){
  var t=q.toLowerCase();
  var ans='Te puedo guiar por la app: Perfil, Yo mam√°, Tribu y Nawi Wawa. ¬øQu√© necesitas?';
  if(t.indexOf('perfil')>-1) ans='Para ver/editar tu perfil: Tabbar ‚Üí Perfil. Ah√≠ cambias nombre e hijos con ‚úèÔ∏è.';
  if(t.indexOf('yo mam√°')>-1 || t.indexOf('yo mama')>-1 || t.indexOf('registro')>-1) ans='En Yo mam√° selecciona un tipo (Salud, Sue√±o, etc.), pon un valor 1‚Äì5 y Guarda. Se refleja en el calendario.';
  if(t.indexOf('tribu')>-1 || t.indexOf('charl')>-1 || t.indexOf('reuni')>-1) ans='En Tribu ver√°s charlas. Para crear una, toca ‚ÄúProgramar reuni√≥n‚Äù y completa el modal.';
  if(t.indexOf('nawi')>-1 || t.indexOf('ni√±e')>-1 || t.indexOf('nana')>-1) ans='En Nawi Wawa filtra por distrito y modalidad (cama adentro/afuera) y contacta por WhatsApp.';
  if(t.indexOf('lact')>-1) ans='Lactancia: tomas cada 2‚Äì3h suelen funcionar en RN. Observa se√±ales tempranas.';
  if(t.indexOf('sue√±')>-1 || t.indexOf('siest')>-1) ans='Sue√±o: ventana de vigilia 45‚Äì60 min y ambiente oscuro + ruido blanco.';
  if(t.indexOf('rutina')>-1) ans='Rutina: 2‚Äì3 anclas (ba√±o, canci√≥n, arrullo) ayudan a anticipar.';
  if(t.indexOf('uso la app')>-1 || t.indexOf('c√≥mo uso')>-1) ans='La barra inferior cambia de secci√≥n. Empieza por Perfil, luego usa Yo mam√° para registrar; Tribu para charlas; Nawi Wawa para ni√±eras.';
  addBubble('bot', ans);
}
document.getElementById('btnSend').addEventListener('click', function(){
  var inp=document.getElementById('inp'); var q=inp.value.trim(); if(!q) return;
  addBubble('me', q); inp.value=''; setTimeout(function(){ respond(q); }, 450);
});
document.getElementById('chipAyuda').addEventListener('click', function(){ document.getElementById('inp').value='¬øC√≥mo uso la app?'; document.getElementById('btnSend').click(); });
document.getElementById('chipPerfil').addEventListener('click', function(){ document.getElementById('inp').value='¬øD√≥nde edito mi perfil?'; document.getElementById('btnSend').click(); });
document.getElementById('chipYo').addEventListener('click', function(){ document.getElementById('inp').value='¬øC√≥mo registro mi d√≠a?'; document.getElementById('btnSend').click(); });
document.getElementById('chipTribu').addEventListener('click', function(){ document.getElementById('inp').value='¬øC√≥mo me inscribo a charlas?'; document.getElementById('btnSend').click(); });
document.getElementById('chipNawi').addEventListener('click', function(){ document.getElementById('inp').value='¬øC√≥mo busco una ni√±era?'; document.getElementById('btnSend').click(); });
document.getElementById('chipLactancia').addEventListener('click', function(){ document.getElementById('inp').value='Lactancia'; document.getElementById('btnSend').click(); });
document.getElementById('chipSueno').addEventListener('click', function(){ document.getElementById('inp').value='Sue√±o'; document.getElementById('btnSend').click(); });
document.getElementById('chipRutina').addEventListener('click', function(){ document.getElementById('inp').value='Rutina'; document.getElementById('btnSend').click(); });

/* ===== Nawi (con fotos) ===== */
var dataNannies = [
  {id:1, nombre:'Mar√≠a L√≥pez', distrito:'Lima Este', modalViv:'Cama adentro', rating:4.8, modos:['Por horas','D√≠a','Permanente'], ver:['DNI verificado','Antecedentes'], foto:'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'},
  {id:2, nombre:'Rosa P√©rez', distrito:'Miraflores', modalViv:'Cama afuera', rating:4.6, modos:['Permanente','Nana SOS'], ver:['Entrevista','Referencia'], foto:'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'},
  {id:3, nombre:'Karla D√≠az', distrito:'Lima Sur', modalViv:'Cama adentro', rating:4.7, modos:['Por horas','Nana SOS'], ver:['DNI verificado'], foto:'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'},
  {id:4, nombre:'Elena Cruz', distrito:'San Isidro', modalViv:'Cama afuera', rating:4.9, modos:['D√≠a','Permanente','Nana SOS'], ver:['Referencia','Antecedentes'], foto:'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'}
];
// (los base64 son placeholders; puedes reemplazarlos por im√°genes reales)
var list = document.getElementById('nannies');

function renderList(items){
  list.innerHTML = '';
  items.forEach(function(n){
    var row = document.createElement('div');
    row.className = 'row';
    row.style.gap = '10px';

    var img = document.createElement('img');
    img.className = 'nimg';
    img.alt = n.nombre;
    img.src = n.foto;

    var card = document.createElement('div');
    card.className = 'card';
    card.style.flex = '1';

    var header = document.createElement('div');
    header.className = 'row';
    header.style.justifyContent = 'space-between';

    var left = document.createElement('div');
    left.appendChild(document.createTextNode(n.nombre+' '));
    var b1=document.createElement('span'); b1.className='badge'; b1.textContent=n.distrito; left.appendChild(b1);
    var b2=document.createElement('span'); b2.className='badge'; b2.style.marginLeft='6px'; b2.textContent=n.modalViv; left.appendChild(b2);

    var rate = document.createElement('div');
    rate.className = 'pill';
    rate.textContent = '‚òÖ ' + n.rating;

    header.appendChild(left);
    header.appendChild(rate);

    var modos = document.createElement('div');
    modos.className = 'row';
    modos.style.marginTop = '6px';
    modos.style.flexWrap = 'wrap';
    n.modos.forEach(function(m){
      var s=document.createElement('span'); s.className='pill'; s.textContent=m; modos.appendChild(s);
    });

    var ver = document.createElement('div');
    ver.className = 'row';
    ver.style.marginTop = '6px';
    ver.style.flexWrap = 'wrap';
    n.ver.forEach(function(v){
      var s=document.createElement('span'); s.className='pill'; s.textContent='‚úÖ '+v; ver.appendChild(s);
    });

    var actions = document.createElement('div');
    actions.className = 'row';
    actions.style.marginTop = '8px';

    var btnVer = document.createElement('button');
    btnVer.className = 'btn';
    btnVer.textContent = 'Ver';
    btnVer.addEventListener('click', function(){ alert('Ver perfil (demo)'); });

    var btnWa = document.createElement('button');
    btnWa.className = 'btn brand';
    btnWa.textContent = 'WhatsApp';
    btnWa.addEventListener('click', function(){ alert('Abrir√≠a WhatsApp (demo)'); });

    actions.appendChild(btnVer);
    actions.appendChild(btnWa);

    card.appendChild(header);
    card.appendChild(modos);
    card.appendChild(ver);
    card.appendChild(actions);

    row.appendChild(img);
    row.appendChild(card);

    list.appendChild(row);
  });
}
function filtrarNawi(){
  var z = document.getElementById('f_zona').value;
  var m = document.getElementById('f_modal').value;
  var out = dataNannies.filter(function(n){
    var okZ = !z || n.distrito===z;
    var okM = !m || n.modalViv===m;
    return okZ && okM;
  });
  renderList(out);
}
document.getElementById('btnBuscarNawi').addEventListener('click', filtrarNawi);
renderList(dataNannies);

/* ===== Tribu (agenda) ===== */
var agenda = [
  {id:1, titulo:'Charla: Sue√±o del RN', fecha:'2025-11-05', hora:'19:00', modo:'Virtual (Zoom)', tema:'Higiene del sue√±o 0‚Äì3m', expositora:'Lic. Ana Corrales'},
  {id:2, titulo:'Taller: Lactancia sin dolor', fecha:'2025-11-08', hora:'10:00', modo:'Presencial (Miraflores)', tema:'Agarre y posturas', expositora:'Dra. Mar√≠a Paredes'},
  {id:3, titulo:'Conversatorio: Retorno al trabajo', fecha:'2025-11-12', hora:'19:30', modo:'Virtual (Meet)', tema:'Red de apoyo y emociones', expositora:'Psic. Laura R√≠os'}
];

function renderAgenda(){
  var wrap = document.getElementById('agenda'); wrap.innerHTML='';
  agenda.forEach(function(a){
    var card=document.createElement('div'); card.className='card';

    var header=document.createElement('div'); header.className='row'; header.style.justifyContent='space-between';
    var h4=document.createElement('h4'); h4.style.margin='0'; h4.textContent=a.titulo;
    var badge=document.createElement('span'); badge.className='badge'; badge.textContent=a.modo;
    header.appendChild(h4); header.appendChild(badge);

    var row=document.createElement('div'); row.className='row';
    var s1=document.createElement('span'); s1.className='pill'; s1.textContent='üóì '+new Date(a.fecha).toLocaleDateString();
    var s2=document.createElement('span'); s2.className='pill'; s2.textContent='‚è∞ '+a.hora;
    row.appendChild(s1); row.appendChild(s2);

    var tema=document.createElement('div'); tema.className='pill'; tema.textContent='üéØ '+a.tema;
    var expo=document.createElement('div'); expo.className='muted'; expo.style.fontSize='13px'; expo.textContent='üë©‚Äçüè´ '+a.expositora;

    var actions=document.createElement('div'); actions.className='row'; actions.style.marginTop='8px';
    var btn=document.createElement('button'); btn.className='btn brand'; btn.textContent='Inscribirme';
    btn.addEventListener('click', function(){ alert('Inscrita en: '+a.titulo); });
    actions.appendChild(btn);

    card.appendChild(header); card.appendChild(row); card.appendChild(tema); card.appendChild(expo); card.appendChild(actions);
    wrap.appendChild(card);
  });
}
renderAgenda();

/* ===== Modal reuniones ===== */
var bk=document.getElementById('bk');
document.getElementById('btnNuevaReunion').addEventListener('click', function(){
  bk.style.display='flex';
  document.getElementById('m_fecha').value = todayStr();
});
document.getElementById('btnCerrarModal').addEventListener('click', function(){ bk.style.display='none'; });
document.getElementById('btnCrearReunion').addEventListener('click', function(){
  var tema=document.getElementById('m_tema').value.trim()||'Charla entre mam√°s';
  var fecha=document.getElementById('m_fecha').value||todayStr();
  var hora=document.getElementById('m_hora').value||'19:00';
  var link=document.getElementById('m_link').value.trim()||'https://zoom.us (demo)';
  agenda.push({id:Date.now(), titulo:tema, fecha:fecha, hora:hora, modo:'Virtual (Zoom)', tema:'Compartir experiencias', expositora:'Comunidad'});
  renderAgenda();
  bk.style.display='none';
  showToast('Reuni√≥n creada: '+link);
});

/* ===== Init ===== */
function renderTodo(){ refrescarPerfil(); renderStats(); dibujarCalendario(); }
initCalendarioToToday();
document.getElementById('logFecha').value = todayStr();
</script>
</body>
</html>